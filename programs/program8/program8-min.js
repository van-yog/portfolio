"use strict";const COUNTER_OF_COINS=7;let counterCoins=7;const COUNTER_OF_BLOCKS=2;let counterBlocks=2;const COUNTER_OF_PLANETS=3;let counterPlanets=3;const MAX_PLANET_SPEED=3;let maxPlanetSpeed=3;const ONE_PLAYER=1;let onePlayer=1;const TWO_PLAYERS=2;let twoPlayers=2;const PLAYER_LIFES=3;let playerLifes=3;const PLANET_IMAGES=5;let planetImgCounter=5;const START_PLAYER_X=70;let startX=70;const START_PLAYER_Y=150;let startY=150;const SHIFT_START_PLAYER_X=5;let shiftStartX=5;const SHIFT_START_PLAYER_Y=50;let shiftStartY=50;const INTERVAL_BETWEEN_BLOCKS=160;let interval=160;const START_SPEED=1;let noLifes,startSpeed=1,pathImg="./src/img/",pathAudio="./src/audio/";class Img{constructor(e,t=""){return this.img=new Image,this.img.src=pathImg+e+t+".png",this.img}}class Mp3{constructor(e){return this.audio=new Audio,this.audio.src=pathAudio+e+".mp3",this.audio}}class Player{constructor(e){this.score=0,this.speed=1,this.id=e,this.life=playerLifes,this.x=startX+shiftStartX*e,this.y=e==onePlayer?startY:startY+shiftStartY*e,this.img=new Img("player",e),this.lifeImg=new Img("life",e),this.record=getStorageRecord(e)}draw(){ctx.drawImage(this.img,this.x,this.y++)}checkCrash(){for(let e=0;e<blocks.length;e++){let t=blocks[e].y+blockUp.height,a=this.y+this.img.height,n=this.x+this.img.width>=blocks[e].x,s=this.x<=blocks[e].x+blockUp.width,r=!(!n||!s),o=this.y<=t,l=a>=t+interval,i=!(!o&&!l),c=!(!r||!i);(this.y+this.img.height>=cvs.height-crashLine.height||c)&&(this.life--,noLifes--,isCrash=!0,lifeLoose.play(),this.life||gameOver.play(),blocks=[],createBlocks(counterBlocks),this.x=startX+shiftStartX*this.id,this.y=startY+shiftStartY*this.id)}}checkRecord(){congratulations.play();let e=isTwoPlayers?this.id:"onePlayer";!this.life&&this.record<this.score&&(alert(`Congratulate - Player${this.id}, your RECORD: ${this.score}`),localStorage.setItem(e,this.score))}checkCoinsTouch(){for(let e=0;e<coins.length;e++){let t=Math.abs(coins[e].x-this.x),a=Math.abs(coins[e].y-this.y),n=(coin.width+this.img.width)/2;if(t<n&&a<n){this.score++,this.score%15||(this.score,this.speed++),scoreAudio.play();let t=cvs.width/2;coins[e].y=newCoinY(),coins[e].x=newCoinX(t)}}}drawStatistic(){let e=this.id==onePlayer?160:500,t=this.id==onePlayer?160:500,a=cvs.height-35;for(let e=0;e<this.life;e++)ctx.drawImage(this.lifeImg,t,a),t+=40;ctx.fillStyle="#ffd",ctx.font="26px Verdana",ctx.fillText("Player "+this.id+" - ",e-140,a-15),ctx.font="20px Verdana",ctx.fillText("Record:"+this.record,e,a-45),ctx.fillText("Score: "+this.score,e,a-15)}move(e){if(isPause)return;let t=e.code,a=1==this.id,n=a?"ArrowUp":"KeyW",s=a?"ArrowDown":"KeyS",r=a?"ArrowLeft":"KeyA";t===(a?"ArrowRight":"KeyD")&&(e.preventDefault(),fly.play(),this.x+=25),t===r&&(e.preventDefault(),fly.play(),this.x-=25),t===s&&(e.preventDefault(),this.y+=25),t===n&&(e.preventDefault(),this.y-=35,fly.play()),this.x<=0&&(this.x=0),this.y<=0&&(this.y=0),this.x+this.img.width>=cvs.width&&(this.x=cvs.width-this.img.width)}}let counter=0,isPause=!0,isCrash=!1,isTwoPlayers=!1,speed=startSpeed,coin=new Img("coin"),bgSpace=new Img("bgSpace");bgSpace.onload=drawBackground;let blockUp=new Img("blockUp"),blockDown=new Img("blockDown"),crashLine=new Img("crashLine"),player1=new Img("player1"),player2=new Img("player2"),coins=[],blocks=[],players=[],planets=[],allPlanets=[],fly=new Mp3("fly"),gameOver=new Mp3("gameOver"),beepStart=new Mp3("beepStart"),lifeLoose=new Mp3("lifeLoose"),scoreAudio=new Mp3("scoreAudio"),congratulations=new Mp3("congratulations"),backgroundMusic=new Mp3("backgroundMusic"),cvs=document.querySelector("#canvas"),ctx=cvs.getContext("2d");setStartProperties();let btnNewGame=document.querySelector("#btnNewGame"),btnStartStop=document.querySelector("#btnStartStop"),btnOnePlayer=document.querySelector("#btnOnePlayer"),btnTwoPlayers=document.querySelector("#btnTwoPlayers");function newGame(){location.reload()}function letsPlay(e){isPause=!1,isTwoPlayers=e==twoPlayers,hideControlButtons(),addPlayer(e),startGame()}function startGame(){counter||beepStart.play(),drawGameField(),drawPlayers(),isPause||(backgroundMusic.play(),requestAnimationFrame(startGame))}function drawGameField(){drawBackground(),drawPlanets(),drawCoins(),drawBlocks(),drawCrashLine()}function checkWinner(){isTwoPlayers&&(congratulations.play(),players[0].score==players[1].score?alert("Winner: FRENDSHIP"):players[0].score>players[1].score?alert("Winner: PLAYER - 1"):alert("Winner: PLAYER - 2"))}function drawPlayers(){noLifes||(isPause=!0,gameOver.play(),backgroundMusic.pause(),backgroundMusic.currentTime=0,alert("Game Over"),players.forEach(e=>e.checkRecord()),checkWinner(),newGame());for(let e=0;e<players.length;e++)players[e].drawStatistic(),0!==players[e].life&&(players[e].draw(),players[e].checkCrash(),players[e].checkCoinsTouch(),players[e].speed>speed&&speed++);isCrash&&1!=speed&&(players.forEach(e=>{e.speed--}),speed--,isCrash=!1)}function drawBackground(){ctx.drawImage(bgSpace,0,0)}function drawCrashLine(){ctx.drawImage(crashLine,0,cvs.height-crashLine.height)}function drawCoins(){for(let e=0;e<coins.length;e++)coins[e].x>-60?ctx.drawImage(coin,coins[e].x--,coins[e].y):(coins[e].y=newCoinY(),coins[e].x=newCoinX())}function drawPlanets(){counter++;for(let e=0;e<planets.length;e++)planets[e].x>-60?1==planets[e].speed&&counter%2?ctx.drawImage(planets[e].name,planets[e].x,planets[e].y):2==planets[e].speed&&counter%3?ctx.drawImage(planets[e].name,planets[e].x,planets[e].y):ctx.drawImage(planets[e].name,planets[e].x--,planets[e].y):(planets[e].y=newPlanetY(),planets[e].x=movePlanetX(),planets[e].name=newPlanetName())}function drawBlocks(){for(let e=0;e<blocks.length;e++)if(blocks[e].x+blockUp.width>=0){let t=blocks[e].y+blockUp.height+interval;ctx.drawImage(blockUp,blocks[e].x,blocks[e].y),ctx.drawImage(blockDown,blocks[e].x,t),blocks[e].x-=speed}else{let t=60;blocks[e].y=newBlockY(),blocks[e].x=newBlockX(t)}}function setStartProperties(){localStorage.getItem(onePlayer)||localStorage.setItem(onePlayer,0),localStorage.getItem(twoPlayers)||localStorage.setItem(twoPlayers,0),localStorage.getItem("onePlayer")||localStorage.setItem("onePlayer",0),createPlanets(counterPlanets),createCoins(counterCoins),createBlocks(counterBlocks),setTimeout(drawFirstPlayer,800),setTimeout(drawSecondPlayer,850),crashLine.onload=drawCrashLine}function drawFirstPlayer(){ctx.drawImage(player1,startX,startY)}function drawSecondPlayer(){ctx.drawImage(player2,startX,startY+2*shiftStartY)}function createCoins(e){for(let t=0;t<e;t++)coins.push({x:newCoinX(),y:newCoinY()})}function createPlanets(e){for(let e=1;e<=planetImgCounter;e++){let t=new Img("planet",e);allPlanets.push(t)}for(let t=0;t<e;t++)planets.push({x:newPlanetX(),y:newPlanetY(),name:newPlanetName(),speed:newPlanetSpeed()})}function createBlocks(e){let t=0;for(let a=0;a<e;a++)blocks.push({x:newBlockX(t),y:newBlockY()}),t+=Math.round(2*cvs.width/3)}function newCoinY(){return Math.round(Math.random()*(cvs.height-crashLine.height-50))}function newCoinX(e=0){return Math.round(Math.random()*cvs.width)+e}function newBlockY(){return Math.floor(Math.random()*blockUp.height)-blockUp.height}function newBlockX(e=0){return cvs.width+e}function newPlanetY(){return Math.round(Math.random()*(cvs.height-crashLine.height-50))}function newPlanetX(){return Math.round(Math.random()*cvs.width)}function newPlanetName(){let e=Math.round(4*Math.random());return allPlanets[e]}function newPlanetSpeed(){return Math.ceil(Math.random()*maxPlanetSpeed)}function movePlanetX(){return cvs.width+10}function addPlayer(e){for(let t=1;t<e+1;t++){let e=new Player(t);players.push(e)}noLifes=e*playerLifes}function hideControlButtons(){btnOnePlayer.classList.add("dont-show"),btnTwoPlayers.classList.add("dont-show"),btnStartStop.classList.add("visible")}function movePlayers(e){for(let t=0;t<players.length;t++)players[t].move(e)}function pause(){let e=btnStartStop.innerText;isPause="Pause"===e,btnStartStop.innerText="Pause"===e?"Play":"Pause",startGame()}function getStorageRecord(e){let t=Number(localStorage.getItem(e)),a=Number(localStorage.getItem("onePlayer"));return isTwoPlayers?t:a}function getSpeed(){let e=players[0].life?players[0].score:players[1].score;console.log("getSpeed -> checkScore",e),console.log(e%10),e%10||speed++}btnOnePlayer.addEventListener("click",()=>letsPlay(onePlayer)),btnTwoPlayers.addEventListener("click",()=>letsPlay(twoPlayers)),btnStartStop.addEventListener("click",pause),btnNewGame.addEventListener("click",newGame),document.body.addEventListener("keydown",e=>movePlayers(e));